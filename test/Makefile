YAML_FILE=pandoc.yaml

all: examples

build/html/%.html: %.md ../pandoc-ling.lua
	@mkdir -p $(dir $@)
	pandoc -d $(YAML_FILE) --from=markdown --to=html $< --output=$@

build/pdf/%.pdf: build/latex/%.tex ../pandoc-ling.lua
	@mkdir -p $(dir $@)
	cd build/latex/ ; latexmk -pdf $(<:build/latex/%.tex=%.tex) ;	latexmk -c
	rm $(<:build/latex/%.tex=build/latex/%-tags.tex) # File generated by expex
	mv $(<:%.tex=%.pdf) $@

build/latex/%.tex: %.md ../pandoc-ling.lua
	@mkdir -p $(dir $@)
	pandoc -d $(YAML_FILE) --metadata=latexPackage=expex --from=markdown --to=latex $< --output=$@

EXAMPLE_MD_FILES=$(wildcard *.md)
EXAMPLE_HTML_FILES=$(EXAMPLE_MD_FILES:%.md=build/html/%.html)
EXAMPLE_TEX_FILES=$(EXAMPLE_MD_FILES:%.md=build/latex/%.tex)
EXAMPLE_PDF_FILES=$(EXAMPLE_MD_FILES:%.md=build/pdf/%.pdf)
examples: $(EXAMPLE_HTML_FILES)  $(EXAMPLE_TEX_FILES) $(EXAMPLE_PDF_FILES)


clean:
	rm -r build
